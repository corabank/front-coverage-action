description: Upload Code Coverage to Code Climate
inputs:
  repositoryPath:
    description: The repository path
    required: true
  reporterId:
    description: The Code Climate CC_TEST_REPORTER_ID
    required: true
  nodeVersion:
    description: The node version to use
    default: 16.x
    required: false
  coverageCommand:
    description: The coverage command to use
    default: jest
    required: false
runs:
  using: composite
  steps:
    - uses: actions/checkout@v3
      with:
        path: "${{ inputs.repositoryPath }}"
    - uses: actions/setup-node@v3
      with:
        node-version: "${{ inputs.nodeVersion }}"
    - name: Install dependencies & running tests
      working-directory: "${{ inputs.repositoryPath }}"
    - run: |
        echo node v${{ inputs.nodeVersion }}
        echo CC_ID ${{ inputs.reporterId }}
        echo path ${{ inputs.repositoryPath }}
        echo command ${{ inputs.coverageCommand }}
      shell: bash
    - run: npm install
      shell: bash
    - run: "npm run ${{ inputs.coverageCommand }}"
      shell: bash
    - name: Publishing coverage data to CodeClimate
    - uses: paambaati/codeclimate-action@v3.2.0
      env:
        CC_TEST_REPORTER_ID: "${{ inputs.reporterId }}"
